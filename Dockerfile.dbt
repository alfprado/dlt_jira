FROM python:3.12-slim

WORKDIR /app

# Instalar dependências
RUN pip install --no-cache-dir dbt-core dbt-postgres

# Copiar arquivos dbt
COPY dbt/ /app/

# Configurar variáveis de ambiente
ENV PYTHONPATH=/app
ENV PYTHONUNBUFFERED=1

# Instalar dependências do dbt e executar
CMD ["sh", "-c", "dbt deps --profiles-dir . && dbt run --profiles-dir ."]
